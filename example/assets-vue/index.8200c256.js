import{d as e,s as a,aH as t,o as l,Y as n,b2 as i,_ as o,a5 as s,c as r,M as u,aF as c,I as d,Z as p,bp as v}from"./common.5a7f0626.js";import{_ as f,i as m,$ as y,a as g,b as h,c as b}from"./read.03cd8dda.js";import{u as _}from"./use-lifecycle.6693a5e5.js";const w=window.mars3d,C=w.Cesium;let N,T,q,O=null;function S(){q.getAddress({location:N.getCenter(),success:e=>{O=e}})}function k(e){return q.autoTip({text:e,city:null==O?void 0:O.city,location:N.getCenter()})}function D(e,a){return q.queryText({text:e,count:6,page:a-1,city:null==O?void 0:O.city})}function P(e){I(),e.forEach((e=>{const a=Number(e.lng),t=Number(e.lat);if(isNaN(a)||isNaN(t))return;e.lng=a,e.lat=t;const l=new w.graphic.PointEntity({position:C.Cartesian3.fromDegrees(a,t),style:{pixelSize:10,color:"#3388ff",outline:!0,outlineColor:"#ffffff",outlineWidth:2,scaleByDistance:new C.NearFarScalar(1e3,1,1e6,.1),clampToGround:!0,visibleDepth:!1,label:{text:e.name,font_size:20,color:"rgb(240,255,255)",outline:!0,outlineWidth:2,outlineColor:C.Color.BLACK,horizontalOrigin:C.HorizontalOrigin.CENTER,verticalOrigin:C.VerticalOrigin.BOTTOM,pixelOffsetY:-10,distanceDisplayCondition:new C.DistanceDisplayCondition(0,2e5),clampToGround:!0,visibleDepth:!1}},attr:e});T.addGraphic(l),e._graphic=l})),e.length>1&&T.flyTo()}function x(e){const a=e.split(",");if(2!==a.length)return;const t=Number(a[0]),l=Number(a[1]);if(isNaN(t)||isNaN(l))return;const n=new w.graphic.PointEntity({position:C.Cartesian3.fromDegrees(t,l),style:{color:"#3388ff",pixelSize:10,outline:!0,outlineColor:"#ffffff",outlineWidth:2,scaleByDistance:new C.NearFarScalar(1e3,1,1e6,.1),clampToGround:!0,visibleDepth:!1}});T.addGraphic(n),n.bindPopup(`<div class="mars3d-template-titile">坐标定位</div>\n              <div class="mars3d-template-content" >\n                <div><label>经度</label> ${t}</div>\n                <div><label>纬度</label>${l}</div>\n              </div>`),n.openHighlight(),n.flyTo({radius:1e3,scale:1.5,complete:()=>{n.openPopup()}})}function G(e,a){N.flyToGraphic(e,{...a,complete:()=>T.openPopup(e)})}function I(){T.closePopup(),T.clear()}var E=Object.freeze(Object.defineProperty({__proto__:null,onMounted:function(e){N=e,q=new w.query.GaodePOI({}),T=new w.layer.GraphicLayer({name:"POI查询",pid:99}),T.bindPopup((function(e){var a;const t=null==(a=e.graphic)?void 0:a.attr;if(!t)return;let l=`<div class="mars3d-template-titile"><a href="https://www.amap.com/detail/${t.id}"  target="_black">${t.name}</a></div><div class="mars3d-template-content" >`;if(""!==t.tel&&(l+="<div><label>电话:</label>"+t.tel+"</div>"),t.address&&(l+="<div><label>地址:</label>"+t.address+"</div>"),t.type){const e=t.type;""!==e&&(l+="<div><label>类别:</label>"+e+"</div>")}return l+="</div>",l})),N.addLayer(T),N.on(w.EventType.cameraChanged,S)},onUnmounted:function(){N.removeLayer(T),N.off(w.EventType.cameraChanged,S),T.remove(),q=null,O=null,N=null},queryData:k,querySiteList:D,showPOIArr:P,centerAtLonLat:x,flyToGraphic:G,clearLayers:I},Symbol.toStringTag,{value:"Module"}));const z={class:"query-poi__search"},L={key:0,class:"search-list"},j=["onClick"],B={key:1,class:"query-site"},M=["onClick"],$={class:"query-site__context"},A=["title"],F={class:"query-site-sub f-toe"},H=["href"],J={class:"query-site__page"},W={class:"query-site-allcount"};var U=f(e({__name:"index",setup(e){_(E);const f="mars3d_queryGaodePOI",w=a(!1),C=a(""),N=a([]),T=a(!1),q=a([]),O=a(0);let S;const U=()=>{S=setTimeout((()=>{T.value=!1,clearTimeout(S),S=null}),500)},Y=()=>{if(C.value)return;const e=JSON.parse(localStorage.getItem(f));e&&(N.value=(e||[]).map((e=>({value:e}))),T.value=!0),S&&clearTimeout(S),w.value=!1},K=async e=>{C.value=e,y(),function(e){try{const a=JSON.parse(localStorage.getItem(f))||[];a.includes(e)||a.unshift(e),localStorage.setItem(f,JSON.stringify(a.slice(0,10)))}catch(a){throw new Error(a)}}(e),console.log("开始搜索",e),await V(e,1),g(),w.value=!0,T.value=!1};function R(e){var a;"prevent"!==(null==(a=e.target.dataset)?void 0:a.event)&&e.preventDefault()}async function V(e,a){const t=await D(e,a);return(!t.list||t.list.length<=0)&&h("暂无数据"),Number(t.allcount),q.value=t.list||[],O.value=Number(t.allcount)||0,P(t.list||[]),t}return(e,a)=>{const f=t("mars-input"),y=t("mars-icon"),g=t("mars-button"),h=t("a-pagination"),_=t("a-empty"),S=t("mars-dialog");return l(),n(S,{draggable:!1,customClass:"query-poi-pannel",top:"10",left:"10"},{default:i((()=>[o("div",{class:"query-poi",onMousedown:R},[o("div",z,[s(f,{placeholder:"搜索 地点",value:C.value,"onUpdate:value":a[0]||(a[0]=e=>C.value=e),class:"input","data-event":"prevent",onBlur:U,onFocus:Y,allowClear:"",onInput:a[1]||(a[1]=e=>(async e=>{if(""===e)return Y(),void I();if(m(e))return void x(e);w.value=!1;const a=await k(e),t=[];a.list.forEach((e=>{t.every((a=>a.value!==e.name))&&t.push({value:e.name})})),N.value=t,T.value=!0})(C.value))},null,8,["value"]),s(g,{class:"button"},{default:i((()=>[s(y,{icon:"search",width:"20",color:"#fff",onClick:a[2]||(a[2]=e=>K(C.value))})])),_:1})]),T.value?(l(),r("ul",L,[(l(!0),r(u,null,c(N.value,((e,a)=>(l(),r("li",{key:a,class:"search-list__item",onClick:a=>K(e.value)},d(e.value),9,j)))),128))])):p("",!0),w.value?(l(),r("div",B,[q.value&&q.value.length?(l(),r(u,{key:0},[o("ul",null,[(l(!0),r(u,null,c(q.value,((e,a)=>(l(),r("li",{key:a,class:"query-site__item",onClick:v((a=>function(e){const a=e._graphic;if(null===a)return b(e.name+" 无经纬度坐标信息！");G(a,{radius:2e3})}(e)),["stop"])},[o("div",$,[o("p",{class:"query-site-text f-toe",title:e.name},d(a+1)+"、"+d(e.name),9,A),o("p",F,d(e.type),1)]),o("a",{href:"//www.amap.com/detail/"+e.id,target:"_blank",class:"query-site__more"},"更多>>",8,H)],8,M)))),128))]),o("div",J,[o("p",W,"共"+d(O.value)+"条结果",1),s(h,{onChange:a[3]||(a[3]=e=>V(C.value,e)),size:"small",total:O.value,pageSize:"6",simple:!0},null,8,["total"])])],64)):(l(),n(_,{key:1,class:"f-push-10-t"}))])):p("",!0)],32)])),_:1})}}}),[["__scopeId","data-v-55a545eb"]]);export{U as default};
