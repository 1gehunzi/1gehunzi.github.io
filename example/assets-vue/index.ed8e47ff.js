import{d as e,s as a,aH as l,o as u,c as t,a5 as o,b2 as i,_ as n,a4 as r,Y as v,bp as s,Z as d,I as c,M as f}from"./common.5a7f0626.js";import{_ as p,b as g}from"./read.03cd8dda.js";const h={class:"f-mb"},m={class:"f-tac"};var _=p(e({__name:"index",setup(e){const p=window.mapWork,_=a(!1),b=[{title:"户型",dataIndex:"houseType"},{title:"总层数",dataIndex:"floorCount",align:"center"},{title:"操作",dataIndex:"option"}],C=a(1),H=a([]),I=a(0),k=a(0),x=a(0),w=a(0),G=a([]),A=a(!1),D=a(!1),y=a(""),z=()=>{console.log("drawGraphicId应该是绘制的值",y.value);const e=p.produceData(y.value,G.value,C.value,I.value,k.value);y.value="",console.log("生成的数据produceObj",e),e&&(x.value++,H.value.push({houseType:x.value+"号户型",floorCount:e.floorCount,floorHeight:e.floorHeight,minHeight:e.minHeight,maxHeight:e.maxHeight,position:G.value,generateGraphicIdArr:e.generateGraphicIdArr}),D.value=!1,A.value=!0),console.log("表格数据",H.value)},j=()=>{if(A.value)return q();if(!D.value&&0===G.value.length)return g("请先绘制区域");if(0===k.value)return g("最高高度不能为0");if(0===I.value)return g("最低高度不能为0");if(0!==H.value.length){let e;for(let a=0;a<H.value.length;a++)if(e=H.value[a],console.log("item",e,e.position[0][0],w.value),e.position[0][0]===w.value){console.log("jingru zheli"),e.floorCount=C.value;const a=p.produceData(y.value,e.position,C.value,I.value,k.value,e.generateGraphicIdArr);if(y.value="",a){e.generateGraphicIdArr=a.generateGraphicIdArr;break}}z()}else z()},q=()=>{H.value.forEach((e=>{if(e.position[0][0]===w.value){console.log("编辑之后",C.value),e.floorCount=C.value;const a=p.produceData(y.value,e.position,C.value,I.value,k.value,e.generateGraphicIdArr);a&&(e.generateGraphicIdArr=a.generateGraphicIdArr,e.maxHeight=a.maxHeight,e.minHeight=a.minHeight,e.floorCount=a.floorCount,e.floorHeight=a.floorHeight)}}))},E=()=>{T(),p.addData().then((e=>{y.value=e.id,G.value=[],e.points.forEach((e=>{G.value.push([e.lng,e.lat])})),w.value=G.value[0][0],D.value=!0}))},T=()=>{k.value=0,I.value=0,C.value=1,A.value=!1},U=()=>{p.getBuildingHeight().then((e=>{I.value=e.height}))},B=()=>{p.getBuildingHeight().then((e=>{k.value=e.height}))},M=()=>{y.value&&(p.quitDraw(y.value),D.value=!1,G.value=[])},O=()=>{T(),p.quitDraw(y.value),_.value=!1,D.value=!1,A.value=!1,G.value=[],y.value=""},P=()=>{C.value=parseInt(C.value+""),1*C.value<=0&&(g("层数最少为1层"),C.value=1)};return(e,a)=>{const g=l("mars-button"),x=l("a-space"),y=l("mars-icon"),z=l("mars-table"),q=l("mars-dialog"),S=l("a-col"),W=l("a-row"),Y=l("a-form-item"),Z=l("mars-input-number"),F=l("a-form");return u(),t(f,null,[o(q,{visible:!0,right:"10",top:"10",width:"300"},{default:i((()=>[n("div",h,[o(x,null,{default:i((()=>[o(g,{onClick:a[0]||(a[0]=e=>_.value=!0),disabled:_.value},{default:i((()=>[r("新增")])),_:1},8,["disabled"])])),_:1})]),o(z,{size:"small",bordered:"",columns:b,pagination:{pageSize:4},"data-source":H.value},{bodyCell:i((({column:e,record:a})=>["option"===e.dataIndex?(u(),v(x,{key:0},{default:i((()=>[o(y,{icon:"aiming",color:"#f2f2f2",class:"icon-vertical-a",title:"定位",onClick:s((e=>{return l=a,console.log(l.position),void p.map.flyToPositions(l.position);var l}),["stop"])},null,8,["onClick"]),o(y,{icon:"edit",color:"#f2f2f2",class:"icon-vertical-a",title:"编辑",onClick:s((e=>{return l=a,A.value=!0,k.value=l.maxHeight,I.value=l.minHeight,C.value=l.floorCount,_.value=!0,G.value=l.position,void(w.value=G.value[0][0]);var l}),["stop"])},null,8,["onClick"]),o(y,{icon:"delete",color:"#f2f2f2",class:"icon-vertical-a",title:"删除",onClick:s((e=>{return l=a,console.log("删除房型",l,H.value),H.value=H.value.filter((e=>e.position[0][0]!==l.position[0][0]||(e.generateGraphicIdArr.forEach((e=>{p.quitDraw(e)})),!1))),void(A.value&&(_.value=!1,A.value=!1,T()));var l}),["stop"])},null,8,["onClick"])])),_:2},1024)):d("",!0)])),_:1},8,["data-source"])])),_:1}),o(q,{visible:_.value,right:"10",top:"400",width:"300"},{default:i((()=>[o(F,{"label-col":{span:6},"wrapper-col":{span:18}},{default:i((()=>[o(Y,{label:"边界"},{default:i((()=>[o(W,{gutter:5,align:"middle"},{default:i((()=>[o(S,{span:8},{default:i((()=>[n("span",null,c(G.value&&G.value.length>0?"已绘制":"无"),1)])),_:1}),o(S,{span:14},{default:i((()=>[o(g,{onClick:E,disabled:A.value||D.value},{default:i((()=>[r("绘制")])),_:1},8,["disabled"]),o(g,{class:"quitDraw",disabled:A.value,onClick:M},{default:i((()=>[r("清除")])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1}),o(Y,{label:"最低高",name:"minHeight"},{default:i((()=>[o(W,{gutter:5},{default:i((()=>[o(S,{span:15},{default:i((()=>[o(Z,{value:I.value,"onUpdate:value":a[1]||(a[1]=e=>I.value=e)},null,8,["value"])])),_:1}),o(S,{span:5},{default:i((()=>[o(x,{size:"small"},{default:i((()=>[o(g,{class:"small-btn",onClick:U},{default:i((()=>[r("拾取")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),o(Y,{label:"最高高",name:"maxHeight"},{default:i((()=>[o(W,{gutter:5},{default:i((()=>[o(S,{span:15},{default:i((()=>[o(Z,{value:k.value,"onUpdate:value":a[2]||(a[2]=e=>k.value=e)},null,8,["value"])])),_:1}),o(S,{span:5},{default:i((()=>[o(x,{size:"small"},{default:i((()=>[o(g,{class:"small-btn",onClick:B},{default:i((()=>[r("拾取")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),o(Y,{label:"层数",name:"floorCount"},{default:i((()=>[o(W,{gutter:5},{default:i((()=>[o(S,{span:15},{default:i((()=>[o(Z,{value:C.value,"onUpdate:value":a[3]||(a[3]=e=>C.value=e),onChange:P},null,8,["value"])])),_:1})])),_:1})])),_:1}),n("div",m,[o(x,null,{default:i((()=>[o(g,{onClick:j},{default:i((()=>[r("生成")])),_:1}),o(g,{onClick:O},{default:i((()=>[r("退出")])),_:1})])),_:1})])])),_:1})])),_:1},8,["visible"])],64)}}}),[["__scopeId","data-v-1927e84a"]]);export{_ as default};
