import{_ as e,m as t,S as a,u as n,aI as o,O as l,r as i,o as c,c as s,a as d,f as r,z as p,i as u,h,q as y,t as g,bt as f,F as m,p as b,l as v}from"./common.10acb102.js";import{w as k,l as w,m as T,e as S,f as E}from"./style.795f3750.js";const C=e=>(b("data-v-a82e60c6"),e=e(),v(),e),P={class:"f-mb"},_=C((()=>d("span",{class:"mars-pannel-item-label"},"图层状态:",-1))),x={key:0,class:"mars-pannel-item-label",title:"不是所有矢量数据均支持修改全局透明度"},O={key:0,class:"f-mb"},G=C((()=>d("span",{class:"mars-pannel-item-label"},"图层交互:",-1))),U={key:1,class:"f-mb"},J=C((()=>d("span",{class:"mars-pannel-item-label"},"数据维护:",-1))),M={class:"f-mb"},N=C((()=>d("span",null,"数据测试:",-1))),j={class:"f-mb"},z=C((()=>d("span",{class:"mars-pannel-item-label"},"数据导出:",-1))),L={class:"f-mb data-list"};var R=e(t({__name:"graphic-layer-state",props:{interaction:{type:Boolean,default:!0},enabledDraw:{type:Boolean,default:!0},drawLabel1:{default:"图上标绘"},drawLabel2:{default:void 0},defaultCount:{default:100},customEditor:{default:""}},emits:["onStartEditor","onStopEditor"],setup(e,{expose:t,emit:b}){const v=e,C=a({enabledShowHide:!0,enabledPopup:!0,enabledTooltip:!1,enabledRightMenu:!1,enabledOpacity:!0,opacity:1,enabledEdit:!0,hasEdit:!1,hasTable:!1,count:v.defaultCount}),R=n(5),D=window.mapWork,I=D.mars3d;function $(){return D.getManagerLayer?D.getManagerLayer():D.graphicLayer}t({addTableData(e){console.log("addTableData",e);const t=e.graphics;for(let a=t.length-1;a>=0;a--){const e=t[a];e.isPrivate||(re.value.push({key:e.id,name:fe(e)}),e.show&&pe.value.push(e.id))}}}),o((()=>{D.eventTarget&&D.eventTarget.on("defuatData",(e=>{C.opacity=1,C.enabledShowHide=e.enabledShowHide,C.enabledPopup=e.enabledPopup,C.enabledTooltip=e.enabledTooltip,C.enabledRightMenu=e.enabledRightMenu})),setTimeout((()=>{const e=$();if(e){C.enabledShowHide=e.show,C.enabledPopup=e.hasPopup(),C.enabledTooltip=e.hasTooltip(),C.enabledRightMenu=e.hasContextMenu();const t=e.getGraphics();if(t.length>0){const e=t[t.length-1];C.enabledOpacity=e.hasOpacity,C.enabledEdit=e.hasEdit}C.hasTable=t.length>0}}),500)}));const H=e=>{R.value=e.pageSize},F=()=>{$().hasEdit=C.hasEdit,C.enabledPopup=!C.hasEdit,Q()},B=()=>{$().opacity=C.opacity},A=()=>{w();const e=(new Date).getTime(),t=D.addRandomGraphicByCount(C.count);T();const a=((new Date).getTime()-e)/1e3;S(`生成${t||C.count}条数据，共耗时${a.toFixed(2)}秒`);const n=$();ye(n),n.flyTo({duration:0,heading:0,pitch:-40,scale:1.2})},W=()=>{$().flyTo({scale:1.2})},V=()=>{D.startDrawGraphic()},q=()=>{D.startDrawGraphic2()},K=()=>{$().show=C.enabledShowHide},Q=()=>{const e=$();C.enabledPopup?D.bindLayerPopup?D.bindLayerPopup():$().bindPopup((function(e){var t;const a=Z(e);return a["类型"]=null==(t=e.graphic)?void 0:t.type,a["来源"]="我是layer上绑定的Popup",a["备注"]="我支持鼠标交互",I.Util.getTemplateHtml({title:"矢量图层",template:"all",attr:a})}),{pointerEvents:!0}):e.unbindPopup()},X=()=>{const e=$();C.enabledTooltip?e.bindTooltip((function(e){var t;const a=Z(e);return a["类型"]=null==(t=e.graphic)?void 0:t.type,a["来源"]="我是layer上绑定的Toolip",a["备注"]="我支持鼠标移入交互",I.Util.getTemplateHtml({title:"矢量图层",template:"all",attr:a})}),{pointerEvents:!1}):e.unbindTooltip()},Y=()=>{const e=$();C.enabledRightMenu?D.bindLayerContextMenu?D.bindLayerContextMenu():function(){const e=$();e.bindContextMenu([{text:"开始编辑对象",icon:"fa fa-edit",show:function(e){const t=e.graphic;return!(!t||!t.hasEdit)&&!t.isEditing},callback:t=>{const a=t.graphic;if(!a)return!1;a&&e.startEditing(a)}},{text:"停止编辑对象",icon:"fa fa-edit",show:function(e){const t=e.graphic;return!(!t||!t.hasEdit)&&t.isEditing},callback:e=>{const t=e.graphic;if(!t)return!1;t&&t.stopEditing()}},{text:"删除对象",icon:"fa fa-trash-o",show:e=>{const t=e.graphic;return!(!t||t.isDestroy)},callback:t=>{const a=t.graphic;if(!a)return;const n=a.parent;e.removeGraphic(a),n&&e.removeGraphic(n)}},{text:"计算长度",icon:"fa fa-medium",show:function(e){const t=e.graphic;return!!t&&("polyline"===t.type||"polylineP"===t.type||"curve"===t.type||"curveP"===t.type||"polylineVolume"===t.type||"polylineVolumeP"===t.type||"corridor"===t.type||"corridorP"===t.type||"wall"===t.type||"wallP"===t.type)},callback:e=>{const t=e.graphic,a=I.MeasureUtil.formatDistance(t.distance);E("该对象的长度为:"+a)}},{text:"计算周长",icon:"fa fa-medium",show:function(e){const t=e.graphic;return!!t&&("circle"===t.type||"circleP"===t.type||"rectangle"===t.type||"rectangleP"===t.type||"polygon"===t.type||"polygonP"===t.type)},callback:e=>{const t=e.graphic,a=I.MeasureUtil.formatDistance(t.distance);E("该对象的周长为:"+a)}},{text:"计算面积",icon:"fa fa-reorder",show:function(e){var t;const a=e.graphic;return!!a&&("circle"===a.type||"circleP"===a.type||"rectangle"===a.type||"rectangleP"===a.type||("polygon"===a.type||"polygonP"===a.type||"wall"===a.type||"scrollWall"===a.type||"water"===a.type)&&(null==(t=a.positionsShow)?void 0:t.length)>2)},callback:e=>{const t=e.graphic,a=I.MeasureUtil.formatArea(t.area);E("该对象的面积为:"+a)}}])}():e.unbindContextMenu(!0)};function Z(e){var t;if(null==(t=null==e?void 0:e.graphic)?void 0:t.attr)return e.graphic.attr;if(!e.czmObject)return{};let a=e.czmObject._attr||e.czmObject.properties||e.czmObject.attribute;return a&&a.type&&a.attr&&(a=a.attr),null!=a?a:{}}const ee=()=>{const e=$();e.enabledEvent=!1,e.clear(),e.enabledEvent=!0,re.value=[],pe.value=[],v.customEditor?b("onStopEditor"):ie("graphic-editor")},te=()=>{const e=$();if(0===e.length)return void S("当前没有标注任何数据，无需保存！");const t=e.toJSON();I.Util.downloadFile("矢量数据构造参数.json",JSON.stringify(t))},ae=()=>{const e=$();if(0===e.length)return void S("当前没有标注任何数据，无需保存！");const t=e.toGeoJSON();I.Util.downloadFile("矢量数据GeoJSON.json",JSON.stringify(t))},ne=e=>{const t=$(),a=e.file,n=a.name,o=null==n?void 0:n.substring(n.lastIndexOf(".")+1,n.length).toLowerCase();if("json"===o||"geojson"===o){const e=new FileReader;e.readAsText(a,"UTF-8"),e.onloadend=function(e){const a=JSON.parse(this.result);console.log("打开了json文件",a),"graphic"===a.type&&a.data?(t.addGraphic(a.data),t.flyTo()):(t.loadGeoJSON(a,{flyTo:!0}),ye(t))}}else if("kml"===o){const e=new FileReader;e.readAsText(a,"UTF-8"),e.onloadend=function(e){const a=this.result;D.kgUtil.toGeoJSON(a).then((e=>{console.log("kml2geojson转换结果为",e),t.loadGeoJSON(e,{flyTo:!0})}))}}else"kmz"===o?D.kgUtil.toGeoJSON(a).then((e=>{console.log("kmz2geojson",e),t.loadGeoJSON(e,{flyTo:!0})})):S("暂不支持 "+o+" 文件类型的数据！")},oe=n([]),{activate:le,disable:ie,isActivate:ce,updateWidget:se}=k.exports.useWidget();o((()=>{const e=$();e.on(I.EventType.drawCreated,(function(e){(C.hasEdit||v.customEditor)&&de(e.graphic)})),e.on([I.EventType.editStart,I.EventType.editMovePoint,I.EventType.editStyle,I.EventType.editRemovePoint],(function(e){de(e.graphic)})),e.on([I.EventType.editStop,I.EventType.removeGraphic],(function(t){setTimeout((()=>{e.isEditing||(v.customEditor?b("onStopEditor"):ie("graphic-editor"))}),100)}))}));const de=e=>{if(v.customEditor===e.type)return ie("graphic-editor"),void b("onStartEditor",{graphicId:e.id,graphicName:fe(e)});b("onStopEditor"),e._conventStyleJson||(e.style=e.toJSON().style,e._conventStyleJson=!0),ce("graphic-editor")?se("graphic-editor",{data:{graphic:l(e)}}):le({name:"graphic-editor",data:{graphic:l(e)}})},re=n([]),pe=n([]),ue=[{title:"名称",dataIndex:"name",key:"name"},{title:"操作",dataIndex:"caozuo",key:"caozuo",width:60,align:"center"}],he={hideSelectAll:!0,hideDefaultSelections:!0,selectedRowKeys:pe,onChange:e=>{pe.value=e},onSelect:(e,t)=>{const a=$().getGraphicById(e.key);a&&(a.show=t)}};function ye(e){const t=e.graphics;for(let a=t.length-1;a>=0;a--){const e=t[a];e.isPrivate||(re.value.push({key:e.id,name:fe(e)}),e.show&&pe.value.push(e.id))}}o((()=>{const e=$();ye(e),e.on(I.EventType.drawCreated,(function(e){const t=e.graphic;t.isPrivate||(re.value.push({key:t.id,name:fe(t)}),pe.value.push(t.id))})),e.on(I.EventType.removeGraphic,(function(e){const t=e.graphic.id,a=re.value.findIndex((e=>e.key===t));re.value.splice(a,1)}))}));let ge=0;function fe(e){var t,a;return(null==(a=null==(t=null==e?void 0:e.style)?void 0:t.label)?void 0:a.text)?`${e.type} - ${e.style.label.text}`:e.name?`${e.type} - ${e.name}`:e.attr.remark?`${e.type} - ${e.attr.remark}`:(e.name="未命名"+ ++ge,`${e.type} - ${e.name}`)}const me=e=>({onClick:()=>{$().getGraphicById(e.key).flyTo()}});return(e,t)=>{const a=i("a-checkbox"),n=i("mars-slider"),o=i("mars-icon"),l=i("mars-button"),b=i("a-space"),k=i("mars-input-number"),w=i("a-upload"),T=i("mars-table");return c(),s(m,null,[d("div",P,[r(b,null,{default:p((()=>[_,r(a,{checked:C.enabledShowHide,"onUpdate:checked":t[0]||(t[0]=e=>C.enabledShowHide=e),onChange:K,title:"显示隐藏状态"},{default:p((()=>[u("显示")])),_:1},8,["checked"]),C.enabledOpacity?(c(),s("span",x,"透明度:")):h("",!0),C.enabledOpacity?(c(),y(n,{key:1,value:C.opacity,"onUpdate:value":t[1]||(t[1]=e=>C.opacity=e),min:0,max:1,step:.1,onChange:B},null,8,["value","min","max","step"])):h("",!0),r(l,{onClick:W,title:"视角定位",size:"small",shape:"round"},{default:p((()=>[r(o,{icon:"aiming",class:"icon-vertical-a"}),u(" 定位 ")])),_:1})])),_:1})]),v.interaction?(c(),s("div",O,[r(b,null,{default:p((()=>[G,r(a,{checked:C.enabledPopup,"onUpdate:checked":t[2]||(t[2]=e=>C.enabledPopup=e),onChange:Q,title:"是否绑定Popup鼠标单击弹窗"},{default:p((()=>[u("单击Popup")])),_:1},8,["checked"]),r(a,{checked:C.enabledTooltip,"onUpdate:checked":t[3]||(t[3]=e=>C.enabledTooltip=e),onChange:X,title:"是否绑定Tooltip鼠标移入弹窗"},{default:p((()=>[u("移入Tooltip")])),_:1},8,["checked"]),r(a,{checked:C.enabledRightMenu,"onUpdate:checked":t[4]||(t[4]=e=>C.enabledRightMenu=e),onChange:Y,title:"是否绑定右键菜单"},{default:p((()=>[u("右键菜单")])),_:1},8,["checked"])])),_:1})])):h("",!0),v.enabledDraw?(c(),s("div",U,[r(b,null,{default:p((()=>[J,r(l,{onClick:V},{default:p((()=>[u(g(v.drawLabel1),1)])),_:1}),v.drawLabel2?(c(),y(l,{key:0,onClick:q},{default:p((()=>[u(g(v.drawLabel2),1)])),_:1})):h("",!0),v.interaction&&C.enabledEdit?(c(),y(a,{key:1,checked:C.hasEdit,"onUpdate:checked":t[5]||(t[5]=e=>C.hasEdit=e),onChange:F,title:"是否单击进行编辑状态"},{default:p((()=>[u("是否编辑")])),_:1},8,["checked"])):h("",!0),r(a,{checked:C.hasTable,"onUpdate:checked":t[6]||(t[6]=e=>C.hasTable=e),title:"显示图层内所有矢量数据列表"},{default:p((()=>[u("显示列表")])),_:1},8,["checked"])])),_:1})])):h("",!0),d("div",M,[r(b,null,{default:p((()=>[N,r(k,{min:1,max:1e6,value:C.count,"onUpdate:value":t[7]||(t[7]=e=>C.count=e),step:"1"},null,8,["value"]),u("条 "),r(l,{onClick:A},{default:p((()=>[u("生成")])),_:1}),r(l,{onClick:ee},{default:p((()=>[r(o,{icon:"delete",class:"icon-vertical-a"}),u(" 清除 ")])),_:1})])),_:1})]),d("div",j,[r(b,null,{default:p((()=>[z,r(w,{multiple:!1,name:"file",accept:".json,.geojson","file-list":oe.value,showUploadList:!1,supportServerRender:!0,beforeUpload:()=>!1,onChange:ne},{default:p((()=>[r(l,{title:"打开GeoJSON"},{default:p((()=>[r(o,{icon:"folder-open",class:"icon-vertical-a"}),u(" 打开 ")])),_:1})])),_:1},8,["file-list","beforeUpload"]),r(l,{onClick:ae,title:"保存GeoJSON"},{default:p((()=>[r(o,{icon:"save-one",class:"icon-vertical-a"}),u(" 导出GeoJSON ")])),_:1}),r(l,{onClick:te,title:"导出构造参数Json"},{default:p((()=>[u(" 导出构造JSON ")])),_:1})])),_:1})]),d("div",L,[C.hasTable?(c(),y(T,{key:0,size:"small",pagination:{pageSize:R.value},customRow:me,"row-selection":he,dataSource:re.value,columns:ue,scroll:{x:400,y:400},onChange:H,bordered:""},{bodyCell:p((({column:e,record:t})=>["caozuo"===e.key?(c(),y(b,{key:0},{default:p((()=>[r(o,{title:"修改矢量数据样式",icon:"editor",class:"icon-vertical-a",onClick:f((e=>function(e){const t=$().getGraphicById(e.key);de(t)}(t)),["stop"])},null,8,["onClick"]),r(o,{title:"删除矢量数据",icon:"delete",class:"icon-vertical-a",onClick:f((e=>(e=>{const t=$().getGraphicById(e.key);t&&t.remove(!0)})(t)),["stop"])},null,8,["onClick"])])),_:2},1024)):(c(),s(m,{key:1},[u(g(t.name),1)],64))])),_:1},8,["pagination","dataSource"])):h("",!0)])],64)}}}),[["__scopeId","data-v-a82e60c6"]]);export{R as G};
