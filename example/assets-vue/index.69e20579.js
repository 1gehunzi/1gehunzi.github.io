import{n as e}from"./style.795f3750.js";import{_ as a,m as l,u as t,at as i,aI as s,S as d,r as n,o as u,q as r,z as c,a as p,f as v,i as o,t as g}from"./common.10acb102.js";const y={class:"edit-contain"},m={class:"f-tac load-button"};var h=a(l({__name:"index",setup(a){const l=window.mapWork,h=t(),b=[{type:"input",field:"url",label:"图层URL",value:"//data.mars3d.cn/tile/dizhiChina/{z}/{x}/{y}.png",change(e){f(e),_()}},{type:"select",field:"type",label:"类型",value:"xyz",data:[{value:"xyz",label:"标准金字塔地图"},{value:"wms",label:"WMS标准服务"},{value:"wmts",label:"WMTS标准服务"},{value:"arcgis",label:"ArcGIS标准服务"},{value:"arcgis_cache",label:"ArcGIS切片"},{value:"image",label:"单张图片"}],change(e){h.value.updateField("type",e),_()}},{type:"input",field:"txtLayer",label:"图层名",value:"",change(e){h.value.updateField("txtLayer",e),_()},show:e=>"wms"===e.type||"wmts"===e.type},{type:"select",field:"txtTileFormat",label:"瓦片格式",value:"png",change(e){h.value.updateField("txtLayer",e),_()},show:e=>"wms"===e.type||"wmts"===e.type,data:[{value:"image/png",label:"png"},{value:"image/jpeg",label:"jpeg"}]},{type:"select",field:"CRS",label:"坐标系",value:"",change(e){h.value.updateField("CRS",e),_()},data:[{value:"",label:"默认"},{value:"EPSG:3857",label:"EPSG:3857"},{value:"EPSG:4326",label:"EPSG:4326"},{value:"EPSG:4490",label:"EPSG:4490"}]},{type:"select",field:"chinaCRS",label:"国内坐标系",value:"WGS84",change(e){h.value.updateField("chinaCRS",e),_()},data:[{value:"WGS84",label:"标准无偏"},{value:"GCJ02",label:"国测局偏移"},{value:"BAIDU",label:"百度偏移"}]},{type:"slider",field:"loadLevel",label:"加载层级",step:1,range:!0,min:0,max:21,value:[0,21],change(e){h.value.updateField("loadLevel",e),_()}},{type:"slider",field:"showLevel",label:"显示层级",step:1,range:!0,min:0,max:21,value:[0,21],change(e){h.value.updateField("showLevel",e),_()}},{type:"input",field:"rectangle",label:"矩形范围",value:"",extra:i(e,{onClick:()=>{O()}},"绘制"),extraType:"custom",change(e){""===e&&l.btnClearExtent(),h.value.updateField("rectangle",e),_()}},{type:"slider",field:"opacity",label:"透明度",step:.01,min:0,max:1,value:1,change(e){h.value.updateField("opacity",e),l.changeOpacity(e),_()}},{type:"slider",field:"brightness",label:"亮度",step:.01,min:0,max:1,value:1,change(e){h.value.updateField("brightness",e),l.changeBrightness(e),_()}},{type:"checkbox",field:"agent",label:"代理",data:[{label:"使用代理",value:!0}],change(e){e[0]?h.value.updateField("chkProxy",!0):h.value.updateField("chkProxy",!1),_()}}];let x;const f=e=>{const a=e.toLowerCase();-1!==a.indexOf("wms")?h.value.updateField("type","wms"):-1!==a.indexOf("wmts")?h.value.updateField("type","wmts"):-1!==a.indexOf("_alllayers")?h.value.updateField("type","arcgis_cache"):-1!==a.indexOf("arcgis")?h.value.updateField("type","arcgis"):-1!==a.indexOf("{x}")&&-1!==a.indexOf("{z}")&&h.value.updateField("type","xyz")},S=t("加载图层"),L=t(!1),F=async()=>{L.value?l.removeLayer():l.createTileLayer(x),S.value=L.value?"加载图层":"移除图层",L.value=!L.value},w=()=>{h.value.updateField("rectangle",""),l.btnClearExtent(),l.removeLayer()},C=()=>{l.saveParams(x)};s((()=>{const e=JSON.parse(localStorage.getItem("tileLayer_edit"));e?(h.value.updateFields(e),G(e),e.rectangle&&l.creatHRectangleEntity(JSON.parse(e.rectangle)),console.log("lastData",e)):_()})),l.eventTarget.on("rectangle",(e=>{e.rectangle&&(h.value.updateField("rectangle",JSON.stringify(e.rectangle)),_())}));const _=()=>{const e=h.value.getValues();G(e),l.dataUpdate(x),localStorage.setItem("tileLayer_edit",JSON.stringify(e))},G=e=>{x=d({url:e.url,type:e.type,txtLayer:e.txtLayer,txtTileFormat:e.txtTileFormat,CRS:e.CRS,chinaCRS:e.chinaCRS,minLoadLevel:e.loadLevel[0],maxLoadLevel:e.loadLevel[1],minShowLevel:e.showLevel[0],maxShowLevel:e.showLevel[1],rectangle:e.rectangle?JSON.parse(e.rectangle):null,opacity:e.opacity,brightness:e.brightness,chkProxy:e.chkProxy})},O=()=>{l.btnDrawExtent(x)};return(a,l)=>{const t=n("mars-gui"),i=n("a-space"),s=n("mars-dialog");return u(),r(s,{visible:!0,right:"10",top:"10"},{default:c((()=>[p("div",y,[v(t,{options:b,ref_key:"marsGuiRef",ref:h},null,512),p("div",m,[v(i,null,{default:c((()=>[v(e,{size:"middle",onClick:F},{default:c((()=>[o(g(S.value),1)])),_:1}),v(e,{size:"middle",onClick:w},{default:c((()=>[o("重置参数")])),_:1}),v(e,{size:"middle",onClick:C},{default:c((()=>[o("保存参数")])),_:1})])),_:1})])])])),_:1})}}}),[["__scopeId","data-v-406a2086"]]);export{h as default};
