import{d as e,r as t,s as a,au as n,m as o,aH as l,o as i,c,_ as s,a5 as d,b2 as r,a4 as p,Z as u,Y as h,I as y,bp as g,M as f,aC as m,aA as b}from"./common.5a7f0626.js";import{_ as v,w as k,g as w,h as T,b as S,c as E}from"./read.03cd8dda.js";const C=e=>(m("data-v-a82e60c6"),e=e(),b(),e),P={class:"f-mb"},_=C((()=>s("span",{class:"mars-pannel-item-label"},"图层状态:",-1))),x={key:0,class:"mars-pannel-item-label",title:"不是所有矢量数据均支持修改全局透明度"},O={key:0,class:"f-mb"},G=C((()=>s("span",{class:"mars-pannel-item-label"},"图层交互:",-1))),U={key:1,class:"f-mb"},J=C((()=>s("span",{class:"mars-pannel-item-label"},"数据维护:",-1))),M={class:"f-mb"},N=C((()=>s("span",null,"数据测试:",-1))),j={class:"f-mb"},L=C((()=>s("span",{class:"mars-pannel-item-label"},"数据导出:",-1))),R={class:"f-mb data-list"};var z=v(e({__name:"graphic-layer-state",props:{interaction:{type:Boolean,default:!0},enabledDraw:{type:Boolean,default:!0},drawLabel1:{default:"图上标绘"},drawLabel2:{default:void 0},defaultCount:{default:100},customEditor:{default:""}},emits:["onStartEditor","onStopEditor"],setup(e,{expose:m,emit:b}){const v=e,C=t({enabledShowHide:!0,enabledPopup:!0,enabledTooltip:!1,enabledRightMenu:!1,enabledOpacity:!0,opacity:1,enabledEdit:!0,hasEdit:!1,hasTable:!1,count:v.defaultCount}),z=a(5),D=window.mapWork,I=D.mars3d;function H(){return D.getManagerLayer?D.getManagerLayer():D.graphicLayer}m({addTableData(e){console.log("addTableData",e);const t=e.graphics;for(let a=t.length-1;a>=0;a--){const e=t[a];e.isPrivate||(re.value.push({key:e.id,name:fe(e)}),e.show&&pe.value.push(e.id))}}}),n((()=>{D.eventTarget&&D.eventTarget.on("defuatData",(e=>{C.opacity=1,C.enabledShowHide=e.enabledShowHide,C.enabledPopup=e.enabledPopup,C.enabledTooltip=e.enabledTooltip,C.enabledRightMenu=e.enabledRightMenu})),setTimeout((()=>{const e=H();if(e){C.enabledShowHide=e.show,C.enabledPopup=e.hasPopup(),C.enabledTooltip=e.hasTooltip(),C.enabledRightMenu=e.hasContextMenu();const t=e.getGraphics();if(t.length>0){const e=t[t.length-1];C.enabledOpacity=e.hasOpacity,C.enabledEdit=e.hasEdit}C.hasTable=t.length>0}}),500)}));const $=e=>{z.value=e.pageSize},B=()=>{H().hasEdit=C.hasEdit,C.enabledPopup=!C.hasEdit,Z()},F=()=>{H().opacity=C.opacity},A=()=>{w();const e=(new Date).getTime(),t=D.addRandomGraphicByCount(C.count);T();const a=((new Date).getTime()-e)/1e3;S(`生成${t||C.count}条数据，共耗时${a.toFixed(2)}秒`);const n=H();ye(n),n.flyTo({duration:0,heading:0,pitch:-40,scale:1.2})},W=()=>{H().flyTo({scale:1.2})},V=()=>{D.startDrawGraphic()},K=()=>{D.startDrawGraphic2()},Y=()=>{H().show=C.enabledShowHide},Z=()=>{const e=H();C.enabledPopup?D.bindLayerPopup?D.bindLayerPopup():H().bindPopup((function(e){var t;const a=X(e);return a["类型"]=null==(t=e.graphic)?void 0:t.type,a["来源"]="我是layer上绑定的Popup",a["备注"]="我支持鼠标交互",I.Util.getTemplateHtml({title:"矢量图层",template:"all",attr:a})}),{pointerEvents:!0}):e.unbindPopup()},q=()=>{const e=H();C.enabledTooltip?e.bindTooltip((function(e){var t;const a=X(e);return a["类型"]=null==(t=e.graphic)?void 0:t.type,a["来源"]="我是layer上绑定的Toolip",a["备注"]="我支持鼠标移入交互",I.Util.getTemplateHtml({title:"矢量图层",template:"all",attr:a})}),{pointerEvents:!1}):e.unbindTooltip()},Q=()=>{const e=H();C.enabledRightMenu?D.bindLayerContextMenu?D.bindLayerContextMenu():function(){const e=H();e.bindContextMenu([{text:"开始编辑对象",icon:"fa fa-edit",show:function(e){const t=e.graphic;return!(!t||!t.hasEdit)&&!t.isEditing},callback:t=>{const a=t.graphic;if(!a)return!1;a&&e.startEditing(a)}},{text:"停止编辑对象",icon:"fa fa-edit",show:function(e){const t=e.graphic;return!(!t||!t.hasEdit)&&t.isEditing},callback:e=>{const t=e.graphic;if(!t)return!1;t&&t.stopEditing()}},{text:"删除对象",icon:"fa fa-trash-o",show:e=>{const t=e.graphic;return!(!t||t.isDestroy)},callback:t=>{const a=t.graphic;if(!a)return;const n=a.parent;e.removeGraphic(a),n&&e.removeGraphic(n)}},{text:"计算长度",icon:"fa fa-medium",show:function(e){const t=e.graphic;return!!t&&("polyline"===t.type||"polylineP"===t.type||"curve"===t.type||"curveP"===t.type||"polylineVolume"===t.type||"polylineVolumeP"===t.type||"corridor"===t.type||"corridorP"===t.type||"wall"===t.type||"wallP"===t.type)},callback:e=>{const t=e.graphic,a=I.MeasureUtil.formatDistance(t.distance);E("该对象的长度为:"+a)}},{text:"计算周长",icon:"fa fa-medium",show:function(e){const t=e.graphic;return!!t&&("circle"===t.type||"circleP"===t.type||"rectangle"===t.type||"rectangleP"===t.type||"polygon"===t.type||"polygonP"===t.type)},callback:e=>{const t=e.graphic,a=I.MeasureUtil.formatDistance(t.distance);E("该对象的周长为:"+a)}},{text:"计算面积",icon:"fa fa-reorder",show:function(e){var t;const a=e.graphic;return!!a&&("circle"===a.type||"circleP"===a.type||"rectangle"===a.type||"rectangleP"===a.type||("polygon"===a.type||"polygonP"===a.type||"wall"===a.type||"scrollWall"===a.type||"water"===a.type)&&(null==(t=a.positionsShow)?void 0:t.length)>2)},callback:e=>{const t=e.graphic,a=I.MeasureUtil.formatArea(t.area);E("该对象的面积为:"+a)}}])}():e.unbindContextMenu(!0)};function X(e){var t;if(null==(t=null==e?void 0:e.graphic)?void 0:t.attr)return e.graphic.attr;if(!e.czmObject)return{};let a=e.czmObject._attr||e.czmObject.properties||e.czmObject.attribute;return a&&a.type&&a.attr&&(a=a.attr),null!=a?a:{}}const ee=()=>{const e=H();e.enabledEvent=!1,e.clear(),e.enabledEvent=!0,re.value=[],pe.value=[],v.customEditor?b("onStopEditor"):ie("graphic-editor")},te=()=>{const e=H();if(0===e.length)return void S("当前没有标注任何数据，无需保存！");const t=e.toJSON();I.Util.downloadFile("矢量数据构造参数.json",JSON.stringify(t))},ae=()=>{const e=H();if(0===e.length)return void S("当前没有标注任何数据，无需保存！");const t=e.toGeoJSON();I.Util.downloadFile("矢量数据GeoJSON.json",JSON.stringify(t))},ne=e=>{const t=H(),a=e.file,n=a.name,o=null==n?void 0:n.substring(n.lastIndexOf(".")+1,n.length).toLowerCase();if("json"===o||"geojson"===o){const e=new FileReader;e.readAsText(a,"UTF-8"),e.onloadend=function(e){const a=JSON.parse(this.result);console.log("打开了json文件",a),"graphic"===a.type&&a.data?(t.addGraphic(a.data),t.flyTo()):(t.loadGeoJSON(a,{flyTo:!0}),ye(t))}}else if("kml"===o){const e=new FileReader;e.readAsText(a,"UTF-8"),e.onloadend=function(e){const a=this.result;D.kgUtil.toGeoJSON(a).then((e=>{console.log("kml2geojson转换结果为",e),t.loadGeoJSON(e,{flyTo:!0})}))}}else"kmz"===o?D.kgUtil.toGeoJSON(a).then((e=>{console.log("kmz2geojson",e),t.loadGeoJSON(e,{flyTo:!0})})):S("暂不支持 "+o+" 文件类型的数据！")},oe=a([]),{activate:le,disable:ie,isActivate:ce,updateWidget:se}=k.exports.useWidget();n((()=>{const e=H();e.on(I.EventType.drawCreated,(function(e){(C.hasEdit||v.customEditor)&&de(e.graphic)})),e.on([I.EventType.editStart,I.EventType.editMovePoint,I.EventType.editStyle,I.EventType.editRemovePoint],(function(e){de(e.graphic)})),e.on([I.EventType.editStop,I.EventType.removeGraphic],(function(t){setTimeout((()=>{e.isEditing||(v.customEditor?b("onStopEditor"):ie("graphic-editor"))}),100)}))}));const de=e=>{if(v.customEditor===e.type)return ie("graphic-editor"),void b("onStartEditor",{graphicId:e.id,graphicName:fe(e)});b("onStopEditor"),e._conventStyleJson||(e.style=e.toJSON().style,e._conventStyleJson=!0),ce("graphic-editor")?se("graphic-editor",{data:{graphic:o(e)}}):le({name:"graphic-editor",data:{graphic:o(e)}})},re=a([]),pe=a([]),ue=[{title:"名称",dataIndex:"name",key:"name"},{title:"操作",dataIndex:"caozuo",key:"caozuo",width:60,align:"center"}],he={hideSelectAll:!0,hideDefaultSelections:!0,selectedRowKeys:pe,onChange:e=>{pe.value=e},onSelect:(e,t)=>{const a=H().getGraphicById(e.key);a&&(a.show=t)}};function ye(e){const t=e.graphics;for(let a=t.length-1;a>=0;a--){const e=t[a];e.isPrivate||(re.value.push({key:e.id,name:fe(e)}),e.show&&pe.value.push(e.id))}}n((()=>{const e=H();ye(e),e.on(I.EventType.drawCreated,(function(e){const t=e.graphic;t.isPrivate||(re.value.push({key:t.id,name:fe(t)}),pe.value.push(t.id))})),e.on(I.EventType.removeGraphic,(function(e){const t=e.graphic.id,a=re.value.findIndex((e=>e.key===t));re.value.splice(a,1)}))}));let ge=0;function fe(e){var t,a;return(null==(a=null==(t=null==e?void 0:e.style)?void 0:t.label)?void 0:a.text)?`${e.type} - ${e.style.label.text}`:e.name?`${e.type} - ${e.name}`:e.attr.remark?`${e.type} - ${e.attr.remark}`:(e.name="未命名"+ ++ge,`${e.type} - ${e.name}`)}const me=e=>({onClick:()=>{H().getGraphicById(e.key).flyTo()}});return(e,t)=>{const a=l("a-checkbox"),n=l("mars-slider"),o=l("mars-icon"),m=l("mars-button"),b=l("a-space"),k=l("mars-input-number"),w=l("a-upload"),T=l("mars-table");return i(),c(f,null,[s("div",P,[d(b,null,{default:r((()=>[_,d(a,{checked:C.enabledShowHide,"onUpdate:checked":t[0]||(t[0]=e=>C.enabledShowHide=e),onChange:Y,title:"显示隐藏状态"},{default:r((()=>[p("显示")])),_:1},8,["checked"]),C.enabledOpacity?(i(),c("span",x,"透明度:")):u("",!0),C.enabledOpacity?(i(),h(n,{key:1,value:C.opacity,"onUpdate:value":t[1]||(t[1]=e=>C.opacity=e),min:0,max:1,step:.1,onChange:F},null,8,["value","min","max","step"])):u("",!0),d(m,{onClick:W,title:"视角定位",size:"small",shape:"round"},{default:r((()=>[d(o,{icon:"aiming",class:"icon-vertical-a"}),p(" 定位 ")])),_:1})])),_:1})]),v.interaction?(i(),c("div",O,[d(b,null,{default:r((()=>[G,d(a,{checked:C.enabledPopup,"onUpdate:checked":t[2]||(t[2]=e=>C.enabledPopup=e),onChange:Z,title:"是否绑定Popup鼠标单击弹窗"},{default:r((()=>[p("单击Popup")])),_:1},8,["checked"]),d(a,{checked:C.enabledTooltip,"onUpdate:checked":t[3]||(t[3]=e=>C.enabledTooltip=e),onChange:q,title:"是否绑定Tooltip鼠标移入弹窗"},{default:r((()=>[p("移入Tooltip")])),_:1},8,["checked"]),d(a,{checked:C.enabledRightMenu,"onUpdate:checked":t[4]||(t[4]=e=>C.enabledRightMenu=e),onChange:Q,title:"是否绑定右键菜单"},{default:r((()=>[p("右键菜单")])),_:1},8,["checked"])])),_:1})])):u("",!0),v.enabledDraw?(i(),c("div",U,[d(b,null,{default:r((()=>[J,d(m,{onClick:V},{default:r((()=>[p(y(v.drawLabel1),1)])),_:1}),v.drawLabel2?(i(),h(m,{key:0,onClick:K},{default:r((()=>[p(y(v.drawLabel2),1)])),_:1})):u("",!0),v.interaction&&C.enabledEdit?(i(),h(a,{key:1,checked:C.hasEdit,"onUpdate:checked":t[5]||(t[5]=e=>C.hasEdit=e),onChange:B,title:"是否单击进行编辑状态"},{default:r((()=>[p("是否编辑")])),_:1},8,["checked"])):u("",!0),d(a,{checked:C.hasTable,"onUpdate:checked":t[6]||(t[6]=e=>C.hasTable=e),title:"显示图层内所有矢量数据列表"},{default:r((()=>[p("显示列表")])),_:1},8,["checked"])])),_:1})])):u("",!0),s("div",M,[d(b,null,{default:r((()=>[N,d(k,{min:1,max:1e6,value:C.count,"onUpdate:value":t[7]||(t[7]=e=>C.count=e),step:"1"},null,8,["value"]),p("条 "),d(m,{onClick:A},{default:r((()=>[p("生成")])),_:1}),d(m,{onClick:ee},{default:r((()=>[d(o,{icon:"delete",class:"icon-vertical-a"}),p(" 清除 ")])),_:1})])),_:1})]),s("div",j,[d(b,null,{default:r((()=>[L,d(w,{multiple:!1,name:"file",accept:".json,.geojson","file-list":oe.value,showUploadList:!1,supportServerRender:!0,beforeUpload:()=>!1,onChange:ne},{default:r((()=>[d(m,{title:"打开GeoJSON"},{default:r((()=>[d(o,{icon:"folder-open",class:"icon-vertical-a"}),p(" 打开 ")])),_:1})])),_:1},8,["file-list","beforeUpload"]),d(m,{onClick:ae,title:"保存GeoJSON"},{default:r((()=>[d(o,{icon:"save-one",class:"icon-vertical-a"}),p(" 导出GeoJSON ")])),_:1}),d(m,{onClick:te,title:"导出构造参数Json"},{default:r((()=>[p(" 导出构造JSON ")])),_:1})])),_:1})]),s("div",R,[C.hasTable?(i(),h(T,{key:0,size:"small",pagination:{pageSize:z.value},customRow:me,"row-selection":he,dataSource:re.value,columns:ue,scroll:{x:400,y:400},onChange:$,bordered:""},{bodyCell:r((({column:e,record:t})=>["caozuo"===e.key?(i(),h(b,{key:0},{default:r((()=>[d(o,{title:"修改矢量数据样式",icon:"editor",class:"icon-vertical-a",onClick:g((e=>function(e){const t=H().getGraphicById(e.key);de(t)}(t)),["stop"])},null,8,["onClick"]),d(o,{title:"删除矢量数据",icon:"delete",class:"icon-vertical-a",onClick:g((e=>(e=>{const t=H().getGraphicById(e.key);t&&t.remove(!0)})(t)),["stop"])},null,8,["onClick"])])),_:2},1024)):(i(),c(f,{key:1},[p(y(t.name),1)],64))])),_:1},8,["pagination","dataSource"])):u("",!0)])],64)}}}),[["__scopeId","data-v-a82e60c6"]]);export{z as G};
