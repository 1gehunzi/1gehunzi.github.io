import{_ as e,m as a,u as t,r as l,o as n,q as i,z as o,a as s,f as r,c as u,F as c,b as d,t as p,h as v,bt as f}from"./common.10acb102.js";import{i as m,$ as y,c as g,e as h,f as b}from"./style.0a538c9f.js";import{u as _}from"./use-lifecycle.49139425.js";const w=window.mars3d,C=w.Cesium;let N,T,q,O=null;function S(){q.getAddress({location:N.getCenter(),success:e=>{O=e}})}function k(e){return q.autoTip({text:e,city:null==O?void 0:O.city,location:N.getCenter()})}function D(e,a){return q.queryText({text:e,count:6,page:a-1,city:null==O?void 0:O.city})}function P(e){z(),e.forEach((e=>{const a=Number(e.lng),t=Number(e.lat);if(isNaN(a)||isNaN(t))return;e.lng=a,e.lat=t;const l=new w.graphic.PointEntity({position:C.Cartesian3.fromDegrees(a,t),style:{pixelSize:10,color:"#3388ff",outline:!0,outlineColor:"#ffffff",outlineWidth:2,scaleByDistance:new C.NearFarScalar(1e3,1,1e6,.1),clampToGround:!0,visibleDepth:!1,label:{text:e.name,font_size:20,color:"rgb(240,255,255)",outline:!0,outlineWidth:2,outlineColor:C.Color.BLACK,horizontalOrigin:C.HorizontalOrigin.CENTER,verticalOrigin:C.VerticalOrigin.BOTTOM,pixelOffsetY:-10,distanceDisplayCondition:new C.DistanceDisplayCondition(0,2e5),clampToGround:!0,visibleDepth:!1}},attr:e});T.addGraphic(l),e._graphic=l})),e.length>1&&T.flyTo()}function x(e){const a=e.split(",");if(2!==a.length)return;const t=Number(a[0]),l=Number(a[1]);if(isNaN(t)||isNaN(l))return;const n=new w.graphic.PointEntity({position:C.Cartesian3.fromDegrees(t,l),style:{color:"#3388ff",pixelSize:10,outline:!0,outlineColor:"#ffffff",outlineWidth:2,scaleByDistance:new C.NearFarScalar(1e3,1,1e6,.1),clampToGround:!0,visibleDepth:!1}});T.addGraphic(n),n.bindPopup(`<div class="mars3d-template-titile">坐标定位</div>\n              <div class="mars3d-template-content" >\n                <div><label>经度</label> ${t}</div>\n                <div><label>纬度</label>${l}</div>\n              </div>`),n.openHighlight(),n.flyTo({radius:1e3,scale:1.5,complete:()=>{n.openPopup()}})}function G(e,a){N.flyToGraphic(e,{...a,complete:()=>T.openPopup(e)})}function z(){T.closePopup(),T.clear()}var E=Object.freeze(Object.defineProperty({__proto__:null,onMounted:function(e){N=e,q=new w.query.GaodePOI({}),T=new w.layer.GraphicLayer({name:"POI查询",pid:99}),T.bindPopup((function(e){var a;const t=null==(a=e.graphic)?void 0:a.attr;if(!t)return;let l=`<div class="mars3d-template-titile"><a href="https://www.amap.com/detail/${t.id}"  target="_black">${t.name}</a></div><div class="mars3d-template-content" >`;if(""!==t.tel&&(l+="<div><label>电话:</label>"+t.tel+"</div>"),t.address&&(l+="<div><label>地址:</label>"+t.address+"</div>"),t.type){const e=t.type;""!==e&&(l+="<div><label>类别:</label>"+e+"</div>")}return l+="</div>",l})),N.addLayer(T),N.on(w.EventType.cameraChanged,S)},onUnmounted:function(){N.removeLayer(T),N.off(w.EventType.cameraChanged,S),T.remove(),q=null,O=null,N=null},queryData:k,querySiteList:D,showPOIArr:P,centerAtLonLat:x,flyToGraphic:G,clearLayers:z},Symbol.toStringTag,{value:"Module"}));const I={class:"query-poi__search"},L={key:0,class:"search-list"},j=["onClick"],B={key:1,class:"query-site"},$=["onClick"],A={class:"query-site__context"},F=["title"],M={class:"query-site-sub f-toe"},J=["href"],W={class:"query-site__page"},H={class:"query-site-allcount"};var U=e(a({__name:"index",setup(e){_(E);const a="mars3d_queryGaodePOI",w=t(!1),C=t(""),N=t([]),T=t(!1),q=t([]),O=t(0);let S;const U=()=>{S=setTimeout((()=>{T.value=!1,clearTimeout(S),S=null}),500)},K=()=>{if(C.value)return;const e=JSON.parse(localStorage.getItem(a));e&&(N.value=(e||[]).map((e=>({value:e}))),T.value=!0),S&&clearTimeout(S),w.value=!1},R=async e=>{C.value=e,y(),function(e){try{const t=JSON.parse(localStorage.getItem(a))||[];t.includes(e)||t.unshift(e),localStorage.setItem(a,JSON.stringify(t.slice(0,10)))}catch(t){throw new Error(t)}}(e),console.log("开始搜索",e),await Y(e,1),g(),w.value=!0,T.value=!1};function V(e){var a;"prevent"!==(null==(a=e.target.dataset)?void 0:a.event)&&e.preventDefault()}async function Y(e,a){const t=await D(e,a);return(!t.list||t.list.length<=0)&&h("暂无数据"),Number(t.allcount),q.value=t.list||[],O.value=Number(t.allcount)||0,P(t.list||[]),t}return(e,a)=>{const t=l("mars-input"),y=l("mars-icon"),g=l("mars-button"),h=l("a-pagination"),_=l("a-empty"),S=l("mars-dialog");return n(),i(S,{draggable:!1,customClass:"query-poi-pannel",top:"10",left:"10"},{default:o((()=>[s("div",{class:"query-poi",onMousedown:V},[s("div",I,[r(t,{placeholder:"搜索 地点",value:C.value,"onUpdate:value":a[0]||(a[0]=e=>C.value=e),class:"input","data-event":"prevent",onBlur:U,onFocus:K,allowClear:"",onInput:a[1]||(a[1]=e=>(async e=>{if(""===e)return K(),void z();if(m(e))return void x(e);w.value=!1;const a=await k(e),t=[];a.list.forEach((e=>{t.every((a=>a.value!==e.name))&&t.push({value:e.name})})),N.value=t,T.value=!0})(C.value))},null,8,["value"]),r(g,{class:"button"},{default:o((()=>[r(y,{icon:"search",width:"20",color:"#fff",onClick:a[2]||(a[2]=e=>R(C.value))})])),_:1})]),T.value?(n(),u("ul",L,[(n(!0),u(c,null,d(N.value,((e,a)=>(n(),u("li",{key:a,class:"search-list__item",onClick:a=>R(e.value)},p(e.value),9,j)))),128))])):v("",!0),w.value?(n(),u("div",B,[q.value&&q.value.length?(n(),u(c,{key:0},[s("ul",null,[(n(!0),u(c,null,d(q.value,((e,a)=>(n(),u("li",{key:a,class:"query-site__item",onClick:f((a=>function(e){const a=e._graphic;if(null===a)return b(e.name+" 无经纬度坐标信息！");G(a,{radius:2e3})}(e)),["stop"])},[s("div",A,[s("p",{class:"query-site-text f-toe",title:e.name},p(a+1)+"、"+p(e.name),9,F),s("p",M,p(e.type),1)]),s("a",{href:"//www.amap.com/detail/"+e.id,target:"_blank",class:"query-site__more"},"更多>>",8,J)],8,$)))),128))]),s("div",W,[s("p",H,"共"+p(O.value)+"条结果",1),r(h,{onChange:a[3]||(a[3]=e=>Y(C.value,e)),size:"small",total:O.value,pageSize:"6",simple:!0},null,8,["total"])])],64)):(n(),i(_,{key:1,class:"f-push-10-t"}))])):v("",!0)],32)])),_:1})}}}),[["__scopeId","data-v-55a545eb"]]);export{U as default};
